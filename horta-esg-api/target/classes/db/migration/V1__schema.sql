CREATE TABLE ESPECIE (
  ID   NUMBER        PRIMARY KEY,
  NOME VARCHAR2(60)  NOT NULL
);

CREATE TABLE CANTEIRO (
  ID              NUMBER        PRIMARY KEY,
  NOME            VARCHAR2(60)  NOT NULL,
  ESPECIE_ID      NUMBER        NOT NULL,
  AREA_M2         NUMBER(10,2)  CHECK (AREA_M2 > 0),
  META_DOACAO_KG  NUMBER(10,2)  CHECK (META_DOACAO_KG > 0),
  CONSTRAINT FK_CANT_ESPECIE FOREIGN KEY (ESPECIE_ID) REFERENCES ESPECIE(ID)
);

CREATE TABLE COLHEITA (
  ID              NUMBER        PRIMARY KEY,
  CANTEIRO_ID     NUMBER        NOT NULL,
  DATA_COLHEITA   DATE          NOT NULL,
  QUANTIDADE_KG   NUMBER(10,2)  CHECK (QUANTIDADE_KG > 0),
  DESTINO_SUGERIDO VARCHAR2(20),
  CONSTRAINT FK_COLH_CANT FOREIGN KEY (CANTEIRO_ID) REFERENCES CANTEIRO(ID)
);

CREATE TABLE DOACAO (
  ID             NUMBER        PRIMARY KEY,
  COLHEITA_ID    NUMBER        NOT NULL,
  INSTITUICAO    VARCHAR2(100) NOT NULL,
  DATA_DOACAO    DATE          NOT NULL,
  QUANTIDADE_KG  NUMBER(10,2)  CHECK (QUANTIDADE_KG >= 0),
  CONSTRAINT FK_DOAC_COLH FOREIGN KEY (COLHEITA_ID) REFERENCES COLHEITA(ID)
);

CREATE INDEX IDX_CANTEIRO_ESPECIE  ON CANTEIRO(ESPECIE_ID);
CREATE INDEX IDX_COLHEITA_CANTEIRO ON COLHEITA(CANTEIRO_ID);
CREATE INDEX IDX_DOACAO_COLHEITA   ON DOACAO(COLHEITA_ID);

CREATE SEQUENCE SEQ_ESPECIE
  START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

CREATE SEQUENCE SEQ_CANTEIRO
  START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

CREATE SEQUENCE SEQ_COLHEITA
  START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

CREATE SEQUENCE SEQ_DOACAO
  START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

CREATE OR REPLACE TRIGGER BI_ESPECIE
BEFORE INSERT ON ESPECIE
FOR EACH ROW
WHEN (NEW.ID IS NULL)
BEGIN
  :NEW.ID := SEQ_ESPECIE.NEXTVAL;
END;
/

CREATE OR REPLACE TRIGGER BI_CANTEIRO
BEFORE INSERT ON CANTEIRO
FOR EACH ROW
WHEN (NEW.ID IS NULL)
BEGIN
  :NEW.ID := SEQ_CANTEIRO.NEXTVAL;
END;
/

CREATE OR REPLACE TRIGGER BI_COLHEITA
BEFORE INSERT ON COLHEITA
FOR EACH ROW
WHEN (NEW.ID IS NULL)
BEGIN
  :NEW.ID := SEQ_COLHEITA.NEXTVAL;
END;
/

CREATE OR REPLACE TRIGGER BI_DOACAO
BEFORE INSERT ON DOACAO
FOR EACH ROW
WHEN (NEW.ID IS NULL)
BEGIN
  :NEW.ID := SEQ_DOACAO.NEXTVAL;
END;
/
